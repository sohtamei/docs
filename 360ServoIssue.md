## 360度サーボFS90R問題について

M5CameraCarでは360度サーボFS90Rを使っています。  
FS90Rは仕様上の問題があり、M5CameraCarでの対処方法と限界についてメモさせて頂きます。

#### 問題１．全体のPWM調整範囲の中で実際の回転数調整に使える調整範囲がごく一部しかない。

PWM分解能4096step(1周期20ms)とした場合PWM設定値とサーボ回転数の関係は下記の通り。調整範囲全体0.7~2.3ms(±163step)の中で、回転数0%から50%までのPWMの調節範囲が約0.06ms (12step) しかない。  

![image](https://user-images.githubusercontent.com/43091864/96787936-94f37880-142d-11eb-84cd-b1c5cf880f62.png)

| 周期 | PWM設定値 | PWM設定オフセット | 回転数 |
| ---- | ---- | ---- | ---- |
| 0.7ms | 143 | -163 | 逆回転100% |
| 1.41ms | 289 | -18 | 逆回転50% |
| 1.47ms | 301 | -6 | 逆回転0% |
| 1.5ms | 307 | ±0 | 停止 |
| 1.53ms | 313 | <font color="#ff0000">+6</font> | 正回転0% |
| 1.59ms | 325 | <font color="#ff0000">+18</font> | 正回転50% |
| 2.3ms | 471 | +163 | 正回転100% |

![image](https://user-images.githubusercontent.com/43091864/96739940-4e852600-13fb-11eb-8d22-d41757b14a31.png)  

#### 問題２．サーボのPWM設定値-回転数が個々のFS90Rごとにばらつく  

上記データは複数のFS90Rの平均値であり、実際には個々のFS90RごとにPWM設定値がグラフ横軸方向に±10step程度ずれる。FS90Rごとに調整しないと回転数50%の正しいPWM設定値を設定することができない。

#### 問題３．サーボの発熱でPWMの設定値が-5setp程度ずれる。

回転数Left=50%(+18step), Right=50%(-18step)になるようPWM設定値を調整しても、発熱により全体で-5stepずれ、Left=32%(+13step相当), Right=61%(-23step相当)になってしまう。

#### 対処方法と限界

- M5CameraCarでは下記動画の治具により回転数0%、50%、100%のPWM設定値を測定しています、この調整値をマイコン(M5Camera)に書き込むことにより回転数50%、100%である程度直進できるようになっています。ただしサーボの発熱等により設定値-回転数のカーブがずれてしまうため正確にまっすぐには進みません。（回転数50%で冷えているとき右方向に反れます）

- 50%未満の回転数では直進するよう調整できなかったため前進方向の回転数は±100%, ±50%の2段階しか設定できません。左右の方向調整は細かく調整できます。

<video src="https://sohta02.web.fc2.com/images/MAH05213s.mp4" width="594" height="540" controls></video>
